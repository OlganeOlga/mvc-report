imports:
    - php

filter:
    excluded_paths: [vendor/*, test/*]

build:
    image: default-bionic

    nodes:
        my-tests:
            before:
                - sudo service mysql start
                - mysql -e 'CREATE DATABASE scrutinizer_db;'
                - cp .env .env.test
                - sed -i 's|DATABASE_URL=.*|DATABASE_URL=sqlite:///%kernel.project_dir%/var/data.db|' .env.test
                - php bin/console doctrine:schema:create --env=test
                - php bin/console doctrine:migrations:migrate --env=test --no-interaction

        environment:
            php:
                version: 8.3.3

    tests:
        override:
            - command: "composer phpunit"
              coverage:
                file: "docs/coverage.clover"
                format: "php-clover"

    analysis:
        tests:
            override:
                - php-scrutinizer-run
                # Uncomment and configure if you have a phpcs config file
                # - phpcs-run
